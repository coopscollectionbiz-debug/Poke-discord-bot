import { SlashCommandBuilder, EmbedBuilder } from 'discord.js';
import { grantTP } from '../bot_final_integrated.js';

export default {
  data: new SlashCommandBuilder()
    .setName('quest')
    .setDescription('View or complete a quest (24 h cooldown).'),
  async execute(interaction, trainerData) {
    const userId = interaction.user.id;
    if (!trainerData[userId]) trainerData[userId] = { tp: 0, cc: 0, pokemon: {}, trainers: {} };
    const user = trainerData[userId];

    const now = Date.now();
    const lastQuest = user.lastQuest || 0;
    if (now - lastQuest < 24 * 60 * 60 * 1000)
      return interaction.reply({ content: 'ðŸ•“ You already completed todayâ€™s quest.', ephemeral: true });

    user.lastQuest = now;
    user.cc += 100;
    await grantTP(interaction, userId, 50);

    const reward = Math.random() < 0.66 ? 'PokÃ©mon' : 'Trainer';
    const embed = new EmbedBuilder()
      .setColor(0x0099ff)
      .setTitle('âœ… Quest Completed!')
      .setDescription(`Rewards:\nâ€¢ 100 CC\nâ€¢ 50 TP\nâ€¢ Random ${reward}`)
      .setFooter({ text: 'Come back tomorrow for a new quest!' });

    return interaction.reply({ embeds: [embed], ephemeral: true });
  }
};
